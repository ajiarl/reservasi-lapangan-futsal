<?php
require '../db.php';
require '../layout_top.php';

$id = $_GET['id'] ?? null;
// Default values (kosong)
$row = ['nama_lapangan'=>'', 'jenis_lapangan'=>'', 'fasilitas'=>'', 'is_active'=>1];

if ($id) {
    // SELECT untuk Edit (Pre-fill form)
    $row = fetchOne("SELECT * FROM lapangan WHERE lapangan_id = ?", [$id]);
    if(!$row) die("Data tidak ditemukan");
}

// PROSES SIMPAN (DML: INSERT / UPDATE)
if (isset($_POST['simpan'])) {
    $nama = trim($_POST['nama']);
    $jenis = trim($_POST['jenis']);
    $fas = trim($_POST['fas']);
    $active = $_POST['active'];

    if ($id) {
        // UPDATE
        q("UPDATE lapangan SET nama_lapangan=?, jenis_lapangan=?, fasilitas=?, is_active=? WHERE lapangan_id=?", 
          [$nama, $jenis, $fas, $active, $id]);
    } else {
        // INSERT
        q("INSERT INTO lapangan (nama_lapangan, jenis_lapangan, fasilitas, is_active) VALUES (?,?,?,?)", 
          [$nama, $jenis, $fas, $active]);
    }
    // Redirect setelah simpan
    echo "<script>window.location='index.php?msg=success';</script>";
}
?>

<div class="card" style="max-width: 600px; margin: 0 auto;">
    <h3><?= $id ? 'Edit' : 'Tambah' ?> Lapangan</h3>
    
    <form method="post">
        <div class="form-group">
            <label>Nama Lapangan</label>
            <input type="text" name="nama" class="form-control" required value="<?= htmlspecialchars($row['nama_lapangan']) ?>">
        </div>
        
        <div class="form-group">
            <label>Jenis Lapangan</label>
            <input type="text" name="jenis" class="form-control" required value="<?= htmlspecialchars($row['jenis_lapangan']) ?>" placeholder="Misal: Rumput Sintetis">
        </div>
        
        <div class="form-group">
            <label>Fasilitas</label>
            <textarea name="fas" class="form-control" required rows="3"><?= htmlspecialchars($row['fasilitas']) ?></textarea>
        </div>

        <div class="form-group">
            <label>Status</label>
            <select name="active" class="form-control">
                <option value="1" <?= $row['is_active']==1 ? 'selected' : '' ?>>Aktif</option>
                <option value="0" <?= $row['is_active']==0 ? 'selected' : '' ?>>Non-Aktif (Perbaikan)</option>
            </select>
        </div>

        <div style="margin-top: 20px;">
            <button name="simpan" class="btn btn-primary">Simpan Data</button>
            <a href="index.php" class="btn btn-secondary">Batal</a>
        </div>
    </form>
</div>

<?php require '../layout_bot.php'; ?>